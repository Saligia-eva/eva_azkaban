## Azkaban 版本升级说明

Azkaban 调度系统的修改升级是基于 **0.9.2** 的基础上做的修改．


## Azkaban 的优化内容：

### 1. 用户到executor 的映射

> 原因:

原 Azkaban 针对公司业务暴露出的问题,多个用户在使用调度系统的时候,由于调度资源有限,有些用户由于作业本身原因亦或bug的问题.
使得作业占用了较多的资源,而影响到其他用户的执行.现在需要将 用户与 executor 产生映射关系.将不同用户的executor 隔离开来.

- 代码逻辑设计:

通过 jdbc 方式获取 `user->execId` 的映射关系.进而获取 `user->executor` 的映射关系.

`ExecutorManager` 在指定 executor 的时候首先判断是否存在有效的映射关系.然后判断是否存在备用节点,以此来获取执行节点.

## 2. 关于 Flow priority 的修改

> 原因 :

开放异构以后,为了方便用户改变自己的优先级,所以将 flow 的优先级开放给普通用户.

> 优化 :

将 flow 的 `flowPriority` 权限开放给用户,如果用户不设置,默认为 `5`.

## 3. 修改 web 到 executor 的任务提交时间超时

## 4. 将用户认证添加到Mysql 中，增加用户黑名单功能.

> 背景

Azkaban 由于存在有些用户使用不规范而导致系统稳定性受到影响，维护成本较大，所以升级用户管理系统，对作业上传与调度由用户组级别细化到用户级别．使得每个用户使用独自的账号执行操作．
这样可以方便管理，追踪用户行为．

> 特点

- 用户使用自己的账户密码登录使用调度系统.
- 同一个用户组之间的用户作业可以互相操作彼此作业(web 端记录修改人信息).
- 同一个用户组之间的用户使用具有相同的用户权限.
- 同一个用户组之间的用户使用相同的　`user proxy` 队列．
- 用户出现违规操作导致调度系统资源紧张时候管理员可以禁用账号一段时间(开始禁用周期为７天，以后按天递增, 禁用期限过后账号自动接触禁用)．　　　　

> 查看操作用户组作业

组内成员作业可以互相操作, 权限如同操作自身作业.

![](http://img.my.csdn.net/uploads/201709/01/1504246022_5452.png)

> 将作业放入 **Persional** 栏目中

为了方便管理可以将某些作业加入 Persional 中,自己可以直接看到

![](http://img.my.csdn.net/uploads/201709/01/1504246022_3838.png)


## 5. 修正用户组设置

当用户有多个用户组时,不为project增加用户组.
当用户只有一个用户组时,为 project 增加用户组所属.

## 6. 为每一个用户默认环境变量设置

增加 yarn 环境的手动配置切换功能, 当一个yarn 集群down掉后能够快速切换 yarn 环境

- 根据用户组名首先获取用户组的当前标志
- 根据用户组与标志获取配置在 `azkaban_flow_properties` 中的变量设置
